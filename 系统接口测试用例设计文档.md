# 水泥厂管理系统 - 接口测试用例设计文档

## 文档概述

本文档详细罗列了水泥厂管理系统的所有功能接口，并设计了对应的测试用例。系统采用前后端分离架构，后端提供RESTful API，前端通过HTTP请求调用后端接口。

## 系统架构

- **后端**: Spring Boot 3 + Java 21
- **前端**: Vue 3 + Vite
- **数据库**: PostgreSQL
- **缓存**: Redis
- **消息队列**: RabbitMQ
- **API文档**: Swagger/OpenAPI 3

---

## 一、后端API接口

### 1. 用户管理模块 (UserController)

#### 1.1 用户注册
- **接口**: `POST /user/register`
- **描述**: 注册新用户，邮箱为必填项
- **参数**:
  - `username`: 用户名 (5-16位，不能包含空格)
  - `password`: 密码 (5-16位，不能包含空格)
  - `email`: 邮箱 (必填)
  - `phone`: 手机号 (可选)

#### 1.2 用户登录
- **接口**: `POST /user/login`
- **描述**: 根据用户名与密码登录，返回JWT Token
- **参数**:
  - `username`: 用户名
  - `password`: 密码

#### 1.3 获取用户信息
- **接口**: `GET /user/userInfo`
- **描述**: 根据Token获取当前用户信息
- **认证**: 需要JWT Token

#### 1.4 更新用户信息
- **接口**: `PUT /user/update`
- **描述**: 更新当前用户的基本信息
- **认证**: 需要JWT Token

#### 1.5 更新头像
- **接口**: `PATCH /user/updateAvatar`
- **描述**: 更新用户头像URL
- **参数**: `avatarUrl`: 头像URL

#### 1.6 修改密码
- **接口**: `PATCH /user/updatePwd`
- **描述**: 修改用户密码
- **参数**:
  - `oldPwd`: 原密码
  - `newPwd`: 新密码
  - `rePwd`: 确认新密码

#### 1.7 用户登出
- **接口**: `POST /user/logout`
- **描述**: 用户登出，清除Token
- **认证**: 需要JWT Token

#### 1.8 获取用户权限
- **接口**: `GET /user/permissions`
- **描述**: 获取当前用户的权限列表
- **认证**: 需要JWT Token

#### 1.9 下载计数管理
- **接口**: `GET /user/daily-download-count`
- **描述**: 获取用户每日下载计数
- **接口**: `POST /user/increment-download`
- **描述**: 增加下载计数
- **接口**: `GET /user/download-limit-check`
- **描述**: 检查下载限制

### 2. 水泥厂管理模块 (CementPlantController)

#### 2.1 水泥厂基本信息管理
- **接口**: `GET /cement-plant/{plantId}`
- **描述**: 根据ID查询水泥厂
- **接口**: `GET /cement-plant/list`
- **描述**: 查询所有水泥厂
- **接口**: `GET /cement-plant/page`
- **描述**: 分页查询水泥厂
- **接口**: `POST /cement-plant`
- **描述**: 新增水泥厂
- **接口**: `PUT /cement-plant`
- **描述**: 更新水泥厂
- **接口**: `DELETE /cement-plant/{plantId}`
- **描述**: 删除水泥厂
- **接口**: `GET /cement-plant/location-range`
- **描述**: 按地理位置范围查询

#### 2.2 水泥厂识别记录管理
- **接口**: `GET /cement-plant/identification/{identificationId}`
- **描述**: 根据ID查询识别记录
- **接口**: `GET /cement-plant/identification/list`
- **描述**: 查询所有识别记录
- **接口**: `GET /cement-plant/identification/page`
- **描述**: 分页查询识别记录
- **接口**: `POST /cement-plant/identification`
- **描述**: 新增识别记录
- **接口**: `PUT /cement-plant/identification`
- **描述**: 更新识别记录
- **接口**: `DELETE /cement-plant/identification/{identificationId}`
- **描述**: 删除识别记录

#### 2.3 统计信息
- **接口**: `GET /cement-plant/stats/active-count`
- **描述**: 获取活跃水泥厂数量
- **接口**: `GET /cement-plant/stats/identification-count/{plantId}`
- **描述**: 获取水泥厂识别记录数量
- **接口**: `GET /cement-plant/stats/identification-count-by-time`
- **描述**: 按时间范围获取识别记录数量

#### 2.4 批量数据新增
- **接口**: `POST /cement-plant/batch-data`
- **描述**: 批量新增水泥厂数据

### 3. 数据查询模块 (DataQueryController)

#### 3.1 水泥厂查询
- **接口**: `GET /data-query/cement-plants/search`
- **描述**: 水泥厂模糊搜索
- **接口**: `GET /data-query/cement-plants/by-region`
- **描述**: 按行政区划查询水泥厂
- **接口**: `GET /data-query/cement-plants/by-location`
- **描述**: 按地理位置查询水泥厂
- **接口**: `GET /data-query/cement-plants/by-status`
- **描述**: 按状态查询水泥厂

#### 3.2 识别记录查询
- **接口**: `GET /data-query/identifications/by-plant`
- **描述**: 查询水泥厂的识别记录
- **接口**: `GET /data-query/identifications/latest`
- **描述**: 获取最新识别记录
- **接口**: `GET /data-query/identifications/by-time-range`
- **描述**: 按时间范围查询识别记录
- **接口**: `GET /data-query/identifications/by-ndvi-range`
- **描述**: 按NDVI范围查询识别记录

#### 3.3 综合查询
- **接口**: `GET /data-query/comprehensive-search`
- **描述**: 综合搜索，支持多条件组合查询

#### 3.4 统计查询
- **接口**: `GET /data-query/statistics/overview`
- **描述**: 获取统计概览
- **接口**: `GET /data-query/statistics/by-region`
- **描述**: 按地区统计
- **接口**: `GET /data-query/statistics/by-time`
- **描述**: 按时间统计

### 4. 数据上传模块 (DataUploadController)

#### 4.1 数据上传
- **接口**: `POST /data-upload/cement-plant-data`
- **描述**: 上传水泥厂识别数据
- **权限**: 仅管理员
- **接口**: `POST /data-upload/batch-cement-plant-data`
- **描述**: 批量上传水泥厂识别数据
- **权限**: 仅管理员

#### 4.2 上传状态
- **接口**: `GET /data-upload/upload-status`
- **描述**: 获取上传状态

### 5. 数据下载模块 (DataDownloadController)

#### 5.1 文件下载
- **接口**: `GET /data-download/tif/{fileId}`
- **描述**: 下载TIF文件
- **接口**: `POST /data-download/batch-download`
- **描述**: 批量下载TIF文件

#### 5.2 下载管理
- **接口**: `GET /data-download/download-status`
- **描述**: 获取下载状态
- **接口**: `GET /data-download/download-history`
- **描述**: 获取下载历史

#### 5.3 异步下载
- **接口**: `POST /data-download/async-download`
- **描述**: 异步下载
- **接口**: `GET /data-download/async-download/{taskId}/status`
- **描述**: 查询异步任务状态
- **接口**: `GET /data-download/async-download/{taskId}/result`
- **描述**: 下载异步任务结果

### 6. 地理数据管理模块 (GeospatialController)

#### 6.1 TIF文件管理
- **接口**: `POST /geo/upload-tif`
- **描述**: 上传TIF文件
- **接口**: `GET /geo/tif-info/{fileId}`
- **描述**: 获取TIF文件信息
- **接口**: `POST /geo/process-tif/{fileId}`
- **描述**: 处理TIF文件
- **接口**: `GET /geo/files`
- **描述**: 获取文件列表

#### 6.2 瓦片服务
- **接口**: `GET /geo/tile/{fileId}/{z}/{x}/{y}`
- **描述**: 获取瓦片数据

### 7. 文件管理模块 (FileUploadController)

#### 7.1 文件操作
- **接口**: `GET /files`
- **描述**: 查询文件列表
- **接口**: `GET /files/{name}`
- **描述**: 查询单个文件信息
- **接口**: `POST /files`
- **描述**: 上传文件 (仅管理员)
- **接口**: `PUT /files/{name}`
- **描述**: 替换文件 (仅管理员)
- **接口**: `DELETE /files/{name}`
- **描述**: 删除文件 (仅管理员)

---

## 二、前端API接口

### 1. 用户管理API (user.js)

```javascript
// 用户认证
export const login = (username, password) => request.post('/user/login', null, { params: { username, password } })
export const register = (username, password) => request.post('/user/register', null, { params: { username, password } })
export const userInfo = () => request.get('/user/userInfo')
export const updateMe = (payload) => request.put('/user/update', payload)
export const updatePwd = (payload) => request.patch('/user/updatePwd', payload)
```

### 2. 水泥厂管理API (cementPlant.js)

```javascript
// 水泥厂基本信息
export const getCementPlants = () => request.get('/cement-plant/list')
export const getCementPlantById = (plantId) => request.get(`/cement-plant/${plantId}`)
export const addCementPlant = (plantData) => request.post('/cement-plant', plantData)
export const updateCementPlant = (plantData) => request.put('/cement-plant', plantData)
export const deleteCementPlant = (plantId) => request.delete(`/cement-plant/${plantId}`)
export const searchCementPlants = (params) => request.get('/cement-plant/page', { params })
export const getCementPlantsByLocation = (minLng, maxLng, minLat, maxLat) => request.get('/cement-plant/location-range', { params: { minLng, maxLng, minLat, maxLat } })

// 识别记录
export const getIdentifications = () => request.get('/cement-plant/identification/list')
export const getIdentificationById = (identificationId) => request.get(`/cement-plant/identification/${identificationId}`)
export const addIdentification = (identificationData) => request.post('/cement-plant/identification', identificationData)
export const updateIdentification = (identificationData) => request.put('/cement-plant/identification', identificationData)
export const deleteIdentification = (identificationId) => request.delete(`/cement-plant/identification/${identificationId}`)
export const searchIdentifications = (params) => request.get('/cement-plant/identification/page', { params })

// 统计
export const getActivePlantsCount = () => request.get('/cement-plant/stats/active-count')
export const getIdentificationCountByPlantId = (plantId) => request.get(`/cement-plant/stats/identification-count/${plantId}`)
export const getIdentificationCountByTimeRange = (startTime, endTime) => request.get('/cement-plant/stats/identification-count-by-time', { params: { startTime, endTime } })
```

### 3. TIF文件管理API (tif.js)

```javascript
// TIF文件管理
export const uploadTifFile = (file, plantId, dataType) => request.post('/geo/upload-tif', formData, { headers: { 'Content-Type': 'multipart/form-data' } })
export const getTifFiles = (fileType, status) => request.get('/geo/files', { params: { fileType, status } })
export const getTifInfo = (fileId) => request.get(`/geo/tif-info/${fileId}`)
export const processTifFile = (fileId) => request.post(`/geo/process-tif/${fileId}`)
export const getTileUrl = (fileId, z, x, y) => `${request.defaults.baseURL}/geo/tile/${fileId}/${z}/${x}/${y}`)

// 下载管理
export const downloadTifFile = (fileId) => request.get(`/data-download/tif/${fileId}`, { responseType: 'blob' })
export const batchDownloadTifFiles = (fileIds) => request.post('/data-download/batch-download', fileIds, { responseType: 'blob' })
export const getDownloadStatus = () => request.get('/data-download/download-status')
export const getDownloadHistory = (pageNum = 1, pageSize = 10) => request.get('/data-download/download-history', { params: { pageNum, pageSize } })

// 异步下载
export const submitAsyncDownload = (fileIds) => request.post('/data-download/async-download', fileIds)
export const getAsyncDownloadStatus = (taskId) => request.get(`/data-download/async-download/${taskId}/status`)
export const downloadAsyncResult = (taskId) => request.get(`/data-download/async-download/${taskId}/result`, { responseType: 'blob' })
```

### 4. GeoServer API (geoserver.js)

```javascript
// GeoServer配置
export function getWmsLayerUrl(layerName, options = {})
export function getWfsLayerUrl(layerName, options = {})
export function getLayerInfo(layerName)
export function getAllLayers()
export function getMapConfig()
export function getBaseMaps()
```

### 5. 管理员API (admin.js)

```javascript
// 用户管理
export const pageUsers = (params) => request.get('/admin/users', { params })
export const addUser = (payload) => request.post('/admin/users', payload)
export const updateUser = (payload) => request.put('/admin/users', payload)
export const deleteUser = (id) => request.delete(`/admin/users/${id}`)
export const getQuota = (id) => request.get(`/admin/users/${id}/quota`)
export const setQuota = (id, value, ttlHours) => request.patch(`/admin/users/${id}/quota`, { value, ttlHours })
```

### 6. 污染物管理API (pollution.js)

```javascript
// 污染物管理
export const pagePollution = (params) => request.get('/pollution', { params })
export const getById = (id) => request.get(`/pollution/${id}`)

// 下载功能
export const download = async (ids) => { /* 下载实现 */ }
export const enqueue = (ids) => request.post('/pollution/async/enqueue', ids)
export const taskStatus = (taskId) => request.get(`/pollution/async/status/${taskId}`)
export const taskResult = async (taskId) => { /* 获取结果 */ }
```

---

## 三、测试用例设计

### 1. 用户管理模块测试用例

#### 1.1 用户注册测试用例

**测试用例 TC001: 正常用户注册**
- **测试目的**: 验证用户注册功能正常工作
- **前置条件**: 系统正常运行
- **测试步骤**:
  1. 发送POST请求到 `/user/register`
  2. 参数: `username=testuser`, `password=123456`, `email=test@example.com`, `phone=13800138000`
- **预期结果**: 
  - 状态码: 200
  - 返回结果包含用户ID、用户名、邮箱
  - 角色代码为1（普通用户）

**测试用例 TC002: 用户名已存在**
- **测试目的**: 验证用户名重复检查
- **前置条件**: 用户 `testuser` 已存在
- **测试步骤**:
  1. 发送POST请求到 `/user/register`
  2. 参数: `username=testuser`, `password=123456`, `email=new@example.com`
- **预期结果**: 
  - 状态码: 409
  - 错误信息: "用户名已被占用"

**测试用例 TC003: 邮箱已存在**
- **测试目的**: 验证邮箱重复检查
- **前置条件**: 邮箱 `test@example.com` 已存在
- **测试步骤**:
  1. 发送POST请求到 `/user/register`
  2. 参数: `username=newuser`, `password=123456`, `email=test@example.com`
- **预期结果**: 
  - 状态码: 409
  - 错误信息: "邮箱已被占用"

**测试用例 TC004: 用户名格式验证**
- **测试目的**: 验证用户名格式验证
- **测试步骤**:
  1. 发送POST请求到 `/user/register`
  2. 参数: `username=ab`, `password=123456`, `email=test@example.com`
- **预期结果**: 
  - 状态码: 400
  - 错误信息: "用户名长度应为5-16位，不能包含空格"

**测试用例 TC005: 密码格式验证**
- **测试目的**: 验证密码格式验证
- **测试步骤**:
  1. 发送POST请求到 `/user/register`
  2. 参数: `username=testuser`, `password=123`, `email=test@example.com`
- **预期结果**: 
  - 状态码: 400
  - 错误信息: "密码长度应为5-16位，不能包含空格"

**测试用例 TC006: 邮箱为空**
- **测试目的**: 验证邮箱必填验证
- **测试步骤**:
  1. 发送POST请求到 `/user/register`
  2. 参数: `username=testuser`, `password=123456`, `email=`
- **预期结果**: 
  - 状态码: 400
  - 错误信息: "邮箱不能为空"

#### 1.2 用户登录测试用例

**测试用例 TC007: 正常用户登录**
- **测试目的**: 验证用户登录功能正常工作
- **前置条件**: 用户 `testuser` 已注册
- **测试步骤**:
  1. 发送POST请求到 `/user/login`
  2. 参数: `username=testuser`, `password=123456`
- **预期结果**: 
  - 状态码: 200
  - 返回结果包含token、用户名、用户ID、角色代码
  - token有效期为24小时

**测试用例 TC008: 用户名不存在**
- **测试目的**: 验证用户名不存在时的处理
- **测试步骤**:
  1. 发送POST请求到 `/user/login`
  2. 参数: `username=nonexistent`, `password=123456`
- **预期结果**: 
  - 状态码: 404
  - 错误信息: "用户名不存在"

**测试用例 TC009: 密码错误**
- **测试目的**: 验证密码错误时的处理
- **前置条件**: 用户 `testuser` 已注册
- **测试步骤**:
  1. 发送POST请求到 `/user/login`
  2. 参数: `username=testuser`, `password=wrongpassword`
- **预期结果**: 
  - 状态码: 401
  - 错误信息: "密码错误"

**测试用例 TC010: 登录失败次数限制**
- **测试目的**: 验证登录失败次数限制
- **前置条件**: 用户 `testuser` 已注册
- **测试步骤**:
  1. 连续5次使用错误密码登录
  2. 第6次尝试登录
- **预期结果**: 
  - 状态码: 429
  - 错误信息: "登录失败次数过多，请15分钟后重试"

**测试用例 TC011: 账户被禁用**
- **测试目的**: 验证账户被禁用时的处理
- **前置条件**: 用户 `testuser` 状态为禁用
- **测试步骤**:
  1. 发送POST请求到 `/user/login`
  2. 参数: `username=testuser`, `password=123456`
- **预期结果**: 
  - 状态码: 403
  - 错误信息: "账户已被禁用，请联系管理员"

#### 1.3 用户信息管理测试用例

**测试用例 TC012: 获取用户信息**
- **测试目的**: 验证获取用户信息功能
- **前置条件**: 用户已登录，有有效token
- **测试步骤**:
  1. 发送GET请求到 `/user/userInfo`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回用户信息（不包含密码）
  - 包含用户名、邮箱、手机号等信息

**测试用例 TC013: 未登录获取用户信息**
- **测试目的**: 验证未登录时的访问控制
- **测试步骤**:
  1. 发送GET请求到 `/user/userInfo`
  2. 不包含Authorization头
- **预期结果**: 
  - 状态码: 401
  - 错误信息: "用户未登录"

**测试用例 TC014: 更新用户信息**
- **测试目的**: 验证更新用户信息功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送PUT请求到 `/user/update`
  2. 请求体包含新的用户信息
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "更新成功"

**测试用例 TC015: 修改密码**
- **测试目的**: 验证修改密码功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送PATCH请求到 `/user/updatePwd`
  2. 请求体包含: `oldPwd`, `newPwd`, `rePwd`
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "密码修改成功，请重新登录"

**测试用例 TC016: 原密码错误**
- **测试目的**: 验证原密码验证
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送PATCH请求到 `/user/updatePwd`
  2. 请求体包含错误的原密码
- **预期结果**: 
  - 状态码: 401
  - 错误信息: "原密码不正确"

**测试用例 TC017: 两次密码不一致**
- **测试目的**: 验证密码确认验证
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送PATCH请求到 `/user/updatePwd`
  2. 请求体包含不一致的新密码和确认密码
- **预期结果**: 
  - 状态码: 400
  - 错误信息: "两次输入的密码不同"

**测试用例 TC018: 用户登出**
- **测试目的**: 验证用户登出功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送POST请求到 `/user/logout`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "登出成功"
  - token被清除

### 2. 水泥厂管理模块测试用例

#### 2.1 水泥厂基本信息测试用例

**测试用例 TC019: 查询水泥厂列表**
- **测试目的**: 验证查询水泥厂列表功能
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/list`
- **预期结果**: 
  - 状态码: 200
  - 返回水泥厂列表
  - 包含水泥厂ID、名称、经纬度、状态等信息

**测试用例 TC020: 根据ID查询水泥厂**
- **测试目的**: 验证根据ID查询水泥厂功能
- **前置条件**: 水泥厂ID为1的记录存在
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/1`
- **预期结果**: 
  - 状态码: 200
  - 返回ID为1的水泥厂详细信息

**测试用例 TC021: 查询不存在的水泥厂**
- **测试目的**: 验证查询不存在水泥厂的处理
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/99999`
- **预期结果**: 
  - 状态码: 404
  - 错误信息: "水泥厂不存在"

**测试用例 TC022: 分页查询水泥厂**
- **测试目的**: 验证分页查询功能
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/page?pageNum=1&pageSize=10`
- **预期结果**: 
  - 状态码: 200
  - 返回分页结果
  - 包含总数、当前页、页大小等信息

**测试用例 TC023: 新增水泥厂**
- **测试目的**: 验证新增水泥厂功能
- **测试步骤**:
  1. 发送POST请求到 `/cement-plant`
  2. 请求体包含水泥厂信息
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "水泥厂添加成功"

**测试用例 TC024: 新增重复名称的水泥厂**
- **测试目的**: 验证水泥厂名称唯一性检查
- **前置条件**: 名称为"测试水泥厂"的水泥厂已存在
- **测试步骤**:
  1. 发送POST请求到 `/cement-plant`
  2. 请求体包含相同名称的水泥厂信息
- **预期结果**: 
  - 状态码: 409
  - 错误信息: "水泥厂名称已存在"

**测试用例 TC025: 更新水泥厂**
- **测试目的**: 验证更新水泥厂功能
- **前置条件**: 水泥厂ID为1的记录存在
- **测试步骤**:
  1. 发送PUT请求到 `/cement-plant`
  2. 请求体包含更新的水泥厂信息
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "水泥厂更新成功"

**测试用例 TC026: 删除水泥厂**
- **测试目的**: 验证删除水泥厂功能
- **前置条件**: 水泥厂ID为1的记录存在
- **测试步骤**:
  1. 发送DELETE请求到 `/cement-plant/1`
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "水泥厂删除成功"

**测试用例 TC027: 按地理位置范围查询**
- **测试目的**: 验证按地理位置范围查询功能
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/location-range?minLng=114&maxLng=115&minLat=30&maxLat=31`
- **预期结果**: 
  - 状态码: 200
  - 返回指定范围内的水泥厂列表

#### 2.2 水泥厂识别记录测试用例

**测试用例 TC028: 查询识别记录列表**
- **测试目的**: 验证查询识别记录列表功能
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/identification/list`
- **预期结果**: 
  - 状态码: 200
  - 返回识别记录列表

**测试用例 TC029: 根据ID查询识别记录**
- **测试目的**: 验证根据ID查询识别记录功能
- **前置条件**: 识别记录ID为1的记录存在
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/identification/1`
- **预期结果**: 
  - 状态码: 200
  - 返回ID为1的识别记录详细信息

**测试用例 TC030: 新增识别记录**
- **测试目的**: 验证新增识别记录功能
- **前置条件**: 水泥厂ID为1的记录存在
- **测试步骤**:
  1. 发送POST请求到 `/cement-plant/identification`
  2. 请求体包含识别记录信息
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "识别记录添加成功"

**测试用例 TC031: 新增识别记录-关联水泥厂不存在**
- **测试目的**: 验证关联水泥厂存在性检查
- **测试步骤**:
  1. 发送POST请求到 `/cement-plant/identification`
  2. 请求体包含不存在的plantId
- **预期结果**: 
  - 状态码: 404
  - 错误信息: "关联的水泥厂不存在"

**测试用例 TC032: 分页查询识别记录**
- **测试目的**: 验证分页查询识别记录功能
- **测试步骤**:
  1. 发送GET请求到 `/cement-plant/identification/page?pageNum=1&pageSize=10`
- **预期结果**: 
  - 状态码: 200
  - 返回分页结果

### 3. 数据查询模块测试用例

#### 3.1 水泥厂查询测试用例

**测试用例 TC033: 水泥厂模糊搜索**
- **测试目的**: 验证水泥厂模糊搜索功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/cement-plants/search?plantName=测试&limit=10`
- **预期结果**: 
  - 状态码: 200
  - 返回包含"测试"的水泥厂列表

**测试用例 TC034: 按行政区划查询水泥厂**
- **测试目的**: 验证按行政区划查询功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/cement-plants/by-region?province=湖北省&city=武汉市`
- **预期结果**: 
  - 状态码: 200
  - 返回指定地区的水泥厂列表

**测试用例 TC035: 按地理位置查询水泥厂**
- **测试目的**: 验证按地理位置查询功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/cement-plants/by-location?longitude=114.3&latitude=30.6&radiusKm=10`
- **预期结果**: 
  - 状态码: 200
  - 返回指定位置10公里范围内的水泥厂列表

**测试用例 TC036: 按状态查询水泥厂**
- **测试目的**: 验证按状态查询功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/cement-plants/by-status?status=active`
- **预期结果**: 
  - 状态码: 200
  - 返回状态为active的水泥厂列表

#### 3.2 识别记录查询测试用例

**测试用例 TC037: 查询水泥厂的识别记录**
- **测试目的**: 验证查询水泥厂识别记录功能
- **前置条件**: 水泥厂ID为1的记录存在
- **测试步骤**:
  1. 发送GET请求到 `/data-query/identifications/by-plant?plantId=1`
- **预期结果**: 
  - 状态码: 200
  - 返回指定水泥厂的所有识别记录

**测试用例 TC038: 获取最新识别记录**
- **测试目的**: 验证获取最新识别记录功能
- **前置条件**: 水泥厂ID为1的记录存在且有识别记录
- **测试步骤**:
  1. 发送GET请求到 `/data-query/identifications/latest?plantId=1`
- **预期结果**: 
  - 状态码: 200
  - 返回最新的识别记录

**测试用例 TC039: 按时间范围查询识别记录**
- **测试目的**: 验证按时间范围查询功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/identifications/by-time-range?startTime=2024-01-01&endTime=2024-12-31`
- **预期结果**: 
  - 状态码: 200
  - 返回指定时间范围内的识别记录

**测试用例 TC040: 按NDVI范围查询识别记录**
- **测试目的**: 验证按NDVI范围查询功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/identifications/by-ndvi-range?minNdvi=0.1&maxNdvi=0.9`
- **预期结果**: 
  - 状态码: 200
  - 返回NDVI在指定范围内的识别记录

#### 3.3 综合查询测试用例

**测试用例 TC041: 综合搜索**
- **测试目的**: 验证综合搜索功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/comprehensive-search?plantName=测试&province=湖北省&status=active&pageNum=1&pageSize=10`
- **预期结果**: 
  - 状态码: 200
  - 返回符合所有条件的识别记录分页结果

**测试用例 TC042: 获取统计概览**
- **测试目的**: 验证获取统计概览功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/statistics/overview`
- **预期结果**: 
  - 状态码: 200
  - 返回系统整体统计数据

**测试用例 TC043: 按地区统计**
- **测试目的**: 验证按地区统计功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/statistics/by-region`
- **预期结果**: 
  - 状态码: 200
  - 返回各省市的水泥厂和识别记录统计

**测试用例 TC044: 按时间统计**
- **测试目的**: 验证按时间统计功能
- **测试步骤**:
  1. 发送GET请求到 `/data-query/statistics/by-time?timeUnit=month`
- **预期结果**: 
  - 状态码: 200
  - 返回按时间维度的统计数据

### 4. 数据上传模块测试用例

#### 4.1 数据上传测试用例

**测试用例 TC045: 上传水泥厂识别数据**
- **测试目的**: 验证上传水泥厂识别数据功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 发送POST请求到 `/data-upload/cement-plant-data`
  2. 请求头包含Authorization: Bearer {admin_token}
  3. 请求体包含水泥厂识别数据
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息: "水泥厂识别数据上传成功"

**测试用例 TC046: 普通用户上传数据**
- **测试目的**: 验证普通用户上传权限控制
- **前置条件**: 用户已登录且为普通用户
- **测试步骤**:
  1. 发送POST请求到 `/data-upload/cement-plant-data`
  2. 请求头包含Authorization: Bearer {user_token}
  3. 请求体包含水泥厂识别数据
- **预期结果**: 
  - 状态码: 403
  - 错误信息: "权限不足，只有管理员可以上传数据"

**测试用例 TC047: 未登录用户上传数据**
- **测试目的**: 验证未登录用户上传权限控制
- **测试步骤**:
  1. 发送POST请求到 `/data-upload/cement-plant-data`
  2. 不包含Authorization头
  3. 请求体包含水泥厂识别数据
- **预期结果**: 
  - 状态码: 401
  - 错误信息: "用户未登录"

**测试用例 TC048: 批量上传水泥厂识别数据**
- **测试目的**: 验证批量上传功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 发送POST请求到 `/data-upload/batch-cement-plant-data`
  2. 请求头包含Authorization: Bearer {admin_token}
  3. 请求体包含多个水泥厂识别数据
- **预期结果**: 
  - 状态码: 200
  - 返回批量处理结果，包含成功和失败数量

**测试用例 TC049: 获取上传状态**
- **测试目的**: 验证获取上传状态功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送GET请求到 `/data-upload/upload-status`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回上传权限和状态信息

### 5. 数据下载模块测试用例

#### 5.1 文件下载测试用例

**测试用例 TC050: 下载TIF文件**
- **测试目的**: 验证下载TIF文件功能
- **前置条件**: 用户已登录，文件ID为1的TIF文件存在
- **测试步骤**:
  1. 发送GET请求到 `/data-download/tif/1`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回TIF文件内容
  - Content-Type为application/octet-stream

**测试用例 TC051: 下载不存在的TIF文件**
- **测试目的**: 验证下载不存在文件的处理
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送GET请求到 `/data-download/tif/99999`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 404
  - 文件不存在

**测试用例 TC052: 未登录用户下载文件**
- **测试目的**: 验证未登录用户下载权限控制
- **测试步骤**:
  1. 发送GET请求到 `/data-download/tif/1`
  2. 不包含Authorization头
- **预期结果**: 
  - 状态码: 401
  - 未授权访问

**测试用例 TC053: 下载配额超限**
- **测试目的**: 验证下载配额限制
- **前置条件**: 用户已登录，今日下载次数已达上限
- **测试步骤**:
  1. 发送GET请求到 `/data-download/tif/1`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 429
   - 错误信息: "每日下载次数已达上限"

**测试用例 TC054: 批量下载TIF文件**
- **测试目的**: 验证批量下载功能
- **前置条件**: 用户已登录，多个TIF文件存在
- **测试步骤**:
  1. 发送POST请求到 `/data-download/batch-download`
  2. 请求头包含Authorization: Bearer {token}
  3. 请求体包含文件ID列表
- **预期结果**: 
  - 状态码: 200
  - 返回ZIP格式的打包文件

#### 5.2 下载管理测试用例

**测试用例 TC055: 获取下载状态**
- **测试目的**: 验证获取下载状态功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送GET请求到 `/data-download/download-status`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回下载权限和配额信息

**测试用例 TC056: 获取下载历史**
- **测试目的**: 验证获取下载历史功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送GET请求到 `/data-download/download-history?pageNum=1&pageSize=10`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回下载历史记录分页结果

#### 5.3 异步下载测试用例

**测试用例 TC057: 提交异步下载任务**
- **测试目的**: 验证提交异步下载任务功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 发送POST请求到 `/data-download/async-download`
  2. 请求头包含Authorization: Bearer {token}
  3. 请求体包含文件ID列表
- **预期结果**: 
  - 状态码: 200
  - 返回任务ID

**测试用例 TC058: 查询异步下载任务状态**
- **测试目的**: 验证查询异步任务状态功能
- **前置条件**: 用户已登录，有异步下载任务
- **测试步骤**:
  1. 发送GET请求到 `/data-download/async-download/{taskId}/status`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回任务状态信息

**测试用例 TC059: 下载异步任务结果**
- **测试目的**: 验证下载异步任务结果功能
- **前置条件**: 用户已登录，异步任务已完成
- **测试步骤**:
  1. 发送GET请求到 `/data-download/async-download/{taskId}/result`
  2. 请求头包含Authorization: Bearer {token}
- **预期结果**: 
  - 状态码: 200
  - 返回任务结果文件

### 6. 地理数据管理模块测试用例

#### 6.1 TIF文件管理测试用例

**测试用例 TC060: 上传TIF文件**
- **测试目的**: 验证上传TIF文件功能
- **测试步骤**:
  1. 发送POST请求到 `/geo/upload-tif`
  2. 请求体包含TIF文件和元数据
- **预期结果**: 
  - 状态码: 200
  - 返回文件ID和处理状态

**测试用例 TC061: 获取TIF文件信息**
- **测试目的**: 验证获取TIF文件信息功能
- **前置条件**: TIF文件ID为1的记录存在
- **测试步骤**:
  1. 发送GET请求到 `/geo/tif-info/1`
- **预期结果**: 
  - 状态码: 200
  - 返回TIF文件详细信息

**测试用例 TC062: 处理TIF文件**
- **测试目的**: 验证处理TIF文件功能
- **前置条件**: TIF文件ID为1的记录存在
- **测试步骤**:
  1. 发送POST请求到 `/geo/process-tif/1`
- **预期结果**: 
  - 状态码: 200
  - 返回处理成功信息

**测试用例 TC063: 获取文件列表**
- **测试目的**: 验证获取文件列表功能
- **测试步骤**:
  1. 发送GET请求到 `/geo/files?fileType=TIF&status=processed`
- **预期结果**: 
  - 状态码: 200
  - 返回符合条件的文件列表

#### 6.2 瓦片服务测试用例

**测试用例 TC064: 获取瓦片数据**
- **测试目的**: 验证获取瓦片数据功能
- **前置条件**: TIF文件ID为1的记录存在且已处理
- **测试步骤**:
  1. 发送GET请求到 `/geo/tile/1/10/512/384`
- **预期结果**: 
  - 状态码: 200
  - 返回PNG格式的瓦片数据
  - Content-Type为image/png

**测试用例 TC065: 获取不存在的瓦片**
- **测试目的**: 验证获取不存在瓦片的处理
- **测试步骤**:
  1. 发送GET请求到 `/geo/tile/99999/10/512/384`
- **预期结果**: 
  - 状态码: 404
  - 瓦片不存在

**测试用例 TC066: 瓦片坐标验证**
- **测试目的**: 验证瓦片坐标参数验证
- **测试步骤**:
  1. 发送GET请求到 `/geo/tile/1/-1/512/384`
- **预期结果**: 
  - 状态码: 400
  - 坐标参数无效

### 7. 文件管理模块测试用例

#### 7.1 文件操作测试用例

**测试用例 TC067: 查询文件列表**
- **测试目的**: 验证查询文件列表功能
- **测试步骤**:
  1. 发送GET请求到 `/files`
- **预期结果**: 
  - 状态码: 200
  - 返回文件列表

**测试用例 TC068: 查询单个文件信息**
- **测试目的**: 验证查询单个文件信息功能
- **前置条件**: 文件名为test.tif的文件存在
- **测试步骤**:
  1. 发送GET请求到 `/files/test.tif`
- **预期结果**: 
  - 状态码: 200
  - 返回文件详细信息

**测试用例 TC069: 上传文件（管理员）**
- **测试目的**: 验证管理员上传文件功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 发送POST请求到 `/files`
  2. 请求头包含Authorization: Bearer {admin_token}
  3. 请求体包含文件内容
- **预期结果**: 
  - 状态码: 200
  - 返回文件名

**测试用例 TC070: 普通用户上传文件**
- **测试目的**: 验证普通用户上传权限控制
- **前置条件**: 用户已登录且为普通用户
- **测试步骤**:
  1. 发送POST请求到 `/files`
  2. 请求头包含Authorization: Bearer {user_token}
  3. 请求体包含文件内容
- **预期结果**: 
  - 状态码: 403
  - 错误信息: "无权限"

**测试用例 TC071: 替换文件（管理员）**
- **测试目的**: 验证管理员替换文件功能
- **前置条件**: 用户已登录且为管理员，文件存在
- **测试步骤**:
  1. 发送PUT请求到 `/files/test.tif`
  2. 请求头包含Authorization: Bearer {admin_token}
  3. 请求体包含新文件内容
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息

**测试用例 TC072: 删除文件（管理员）**
- **测试目的**: 验证管理员删除文件功能
- **前置条件**: 用户已登录且为管理员，文件存在
- **测试步骤**:
  1. 发送DELETE请求到 `/files/test.tif`
  2. 请求头包含Authorization: Bearer {admin_token}
- **预期结果**: 
  - 状态码: 200
  - 返回成功信息

---

## 四、前端接口测试用例

### 1. 用户管理API测试用例

#### 1.1 用户认证测试用例

**测试用例 TC073: 前端用户登录**
- **测试目的**: 验证前端用户登录功能
- **测试步骤**:
  1. 调用 `login('testuser', '123456')`
- **预期结果**: 
  - 返回包含token的响应
  - token存储到localStorage
  - 用户状态更新

**测试用例 TC074: 前端用户注册**
- **测试目的**: 验证前端用户注册功能
- **测试步骤**:
  1. 调用 `register('newuser', '123456')`
- **预期结果**: 
  - 返回注册成功信息
  - 用户信息正确显示

**测试用例 TC075: 获取用户信息**
- **测试目的**: 验证获取用户信息功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 调用 `userInfo()`
- **预期结果**: 
  - 返回用户详细信息
  - 不包含密码信息

**测试用例 TC076: 更新用户信息**
- **测试目的**: 验证更新用户信息功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 调用 `updateMe({ username: 'newname', email: 'new@example.com' })`
- **预期结果**: 
  - 返回更新成功信息
  - 用户信息更新

**测试用例 TC077: 修改密码**
- **测试目的**: 验证修改密码功能
- **前置条件**: 用户已登录
- **测试步骤**:
  1. 调用 `updatePwd({ oldPwd: '123456', newPwd: 'newpass', rePwd: 'newpass' })`
- **预期结果**: 
  - 返回修改成功信息
  - 需要重新登录

### 2. 水泥厂管理API测试用例

#### 2.1 水泥厂基本信息测试用例

**测试用例 TC078: 获取水泥厂列表**
- **测试目的**: 验证获取水泥厂列表功能
- **测试步骤**:
  1. 调用 `getCementPlants()`
- **预期结果**: 
  - 返回水泥厂列表
  - 数据格式正确

**测试用例 TC079: 根据ID获取水泥厂**
- **测试目的**: 验证根据ID获取水泥厂功能
- **测试步骤**:
  1. 调用 `getCementPlantById(1)`
- **预期结果**: 
  - 返回指定水泥厂信息
  - 数据完整

**测试用例 TC080: 新增水泥厂**
- **测试目的**: 验证新增水泥厂功能
- **测试步骤**:
  1. 调用 `addCementPlant({ plantName: '新水泥厂', longitude: 114.3, latitude: 30.6 })`
- **预期结果**: 
  - 返回添加成功信息
  - 水泥厂创建成功

**测试用例 TC081: 更新水泥厂**
- **测试目的**: 验证更新水泥厂功能
- **测试步骤**:
  1. 调用 `updateCementPlant({ plantId: 1, plantName: '更新后的水泥厂' })`
- **预期结果**: 
  - 返回更新成功信息
  - 水泥厂信息更新

**测试用例 TC082: 删除水泥厂**
- **测试目的**: 验证删除水泥厂功能
- **测试步骤**:
  1. 调用 `deleteCementPlant(1)`
- **预期结果**: 
  - 返回删除成功信息
  - 水泥厂删除成功

**测试用例 TC083: 搜索水泥厂**
- **测试目的**: 验证搜索水泥厂功能
- **测试步骤**:
  1. 调用 `searchCementPlants({ plantName: '测试', pageNum: 1, pageSize: 10 })`
- **预期结果**: 
  - 返回搜索结果
  - 分页信息正确

**测试用例 TC084: 按地理位置查询水泥厂**
- **测试目的**: 验证按地理位置查询功能
- **测试步骤**:
  1. 调用 `getCementPlantsByLocation(114, 115, 30, 31)`
- **预期结果**: 
  - 返回指定范围内的水泥厂
  - 地理位置正确

#### 2.2 识别记录测试用例

**测试用例 TC085: 获取识别记录列表**
- **测试目的**: 验证获取识别记录列表功能
- **测试步骤**:
  1. 调用 `getIdentifications()`
- **预期结果**: 
  - 返回识别记录列表
  - 数据格式正确

**测试用例 TC086: 根据ID获取识别记录**
- **测试目的**: 验证根据ID获取识别记录功能
- **测试步骤**:
  1. 调用 `getIdentificationById(1)`
- **预期结果**: 
  - 返回指定识别记录信息
  - 数据完整

**测试用例 TC087: 新增识别记录**
- **测试目的**: 验证新增识别记录功能
- **测试步骤**:
  1. 调用 `addIdentification({ plantId: 1, ndviIndex: 0.5, dataSource: 'GF-2' })`
- **预期结果**: 
  - 返回添加成功信息
  - 识别记录创建成功

**测试用例 TC088: 更新识别记录**
- **测试目的**: 验证更新识别记录功能
- **测试步骤**:
  1. 调用 `updateIdentification({ identificationId: 1, ndviIndex: 0.6 })`
- **预期结果**: 
  - 返回更新成功信息
  - 识别记录更新

**测试用例 TC089: 删除识别记录**
- **测试目的**: 验证删除识别记录功能
- **测试步骤**:
  1. 调用 `deleteIdentification(1)`
- **预期结果**: 
  - 返回删除成功信息
  - 识别记录删除

**测试用例 TC090: 搜索识别记录**
- **测试目的**: 验证搜索识别记录功能
- **测试步骤**:
  1. 调用 `searchIdentifications({ plantId: 1, pageNum: 1, pageSize: 10 })`
- **预期结果**: 
  - 返回搜索结果
  - 分页信息正确

#### 2.3 统计测试用例

**测试用例 TC091: 获取活跃水泥厂数量**
- **测试目的**: 验证获取活跃水泥厂数量功能
- **测试步骤**:
  1. 调用 `getActivePlantsCount()`
- **预期结果**: 
  - 返回活跃水泥厂数量
  - 数值正确

**测试用例 TC092: 获取水泥厂识别记录数量**
- **测试目的**: 验证获取水泥厂识别记录数量功能
- **测试步骤**:
  1. 调用 `getIdentificationCountByPlantId(1)`
- **预期结果**: 
  - 返回指定水泥厂的识别记录数量
  - 数值正确

**测试用例 TC093: 按时间范围获取识别记录数量**
- **测试目的**: 验证按时间范围获取识别记录数量功能
- **测试步骤**:
  1. 调用 `getIdentificationCountByTimeRange('2024-01-01', '2024-12-31')`
- **预期结果**: 
  - 返回指定时间范围内的识别记录数量
  - 数值正确

### 3. TIF文件管理API测试用例

#### 3.1 TIF文件管理测试用例

**测试用例 TC094: 上传TIF文件**
- **测试目的**: 验证上传TIF文件功能
- **测试步骤**:
  1. 调用 `uploadTifFile(file, 1, 'NDVI')`
- **预期结果**: 
  - 返回上传成功信息
  - 文件ID正确

**测试用例 TC095: 获取TIF文件列表**
- **测试目的**: 验证获取TIF文件列表功能
- **测试步骤**:
  1. 调用 `getTifFiles('TIF', 'processed')`
- **预期结果**: 
  - 返回符合条件的文件列表
  - 数据格式正确

**测试用例 TC096: 获取TIF文件信息**
- **测试目的**: 验证获取TIF文件信息功能
- **测试步骤**:
  1. 调用 `getTifInfo(1)`
- **预期结果**: 
  - 返回文件详细信息
  - 包含文件大小、坐标系统等信息

**测试用例 TC097: 处理TIF文件**
- **测试目的**: 验证处理TIF文件功能
- **测试步骤**:
  1. 调用 `processTifFile(1)`
- **预期结果**: 
  - 返回处理成功信息
  - 文件状态更新

**测试用例 TC098: 获取瓦片URL**
- **测试目的**: 验证获取瓦片URL功能
- **测试步骤**:
  1. 调用 `getTileUrl(1, 10, 512, 384)`
- **预期结果**: 
  - 返回正确的瓦片URL
  - URL格式正确

#### 3.2 下载管理测试用例

**测试用例 TC099: 下载TIF文件**
- **测试目的**: 验证下载TIF文件功能
- **测试步骤**:
  1. 调用 `downloadTifFile(1)`
- **预期结果**: 
  - 返回文件Blob
  - 文件内容正确

**测试用例 TC100: 批量下载TIF文件**
- **测试目的**: 验证批量下载功能
- **测试步骤**:
  1. 调用 `batchDownloadTifFiles([1, 2, 3])`
- **预期结果**: 
  - 返回ZIP文件Blob
  - 文件内容正确

**测试用例 TC101: 获取下载状态**
- **测试目的**: 验证获取下载状态功能
- **测试步骤**:
  1. 调用 `getDownloadStatus()`
- **预期结果**: 
  - 返回下载状态信息
  - 包含配额信息

**测试用例 TC102: 获取下载历史**
- **测试目的**: 验证获取下载历史功能
- **测试步骤**:
  1. 调用 `getDownloadHistory(1, 10)`
- **预期结果**: 
  - 返回下载历史记录
  - 分页信息正确

#### 3.3 异步下载测试用例

**测试用例 TC103: 提交异步下载任务**
- **测试目的**: 验证提交异步下载任务功能
- **测试步骤**:
  1. 调用 `submitAsyncDownload([1, 2, 3])`
- **预期结果**: 
  - 返回任务ID
  - 任务提交成功

**测试用例 TC104: 获取异步下载任务状态**
- **测试目的**: 验证获取异步任务状态功能
- **测试步骤**:
  1. 调用 `getAsyncDownloadStatus('task-id')`
- **预期结果**: 
  - 返回任务状态信息
  - 状态信息完整

**测试用例 TC105: 下载异步任务结果**
- **测试目的**: 验证下载异步任务结果功能
- **测试步骤**:
  1. 调用 `downloadAsyncResult('task-id')`
- **预期结果**: 
  - 返回结果文件Blob
  - 文件内容正确

### 4. GeoServer API测试用例

#### 4.1 GeoServer配置测试用例

**测试用例 TC106: 获取WMS图层URL**
- **测试目的**: 验证获取WMS图层URL功能
- **测试步骤**:
  1. 调用 `getWmsLayerUrl('cementPlants', { BBOX: '114,30,115,31' })`
- **预期结果**: 
  - 返回正确的WMS URL
  - URL参数正确

**测试用例 TC107: 获取WFS图层URL**
- **测试目的**: 验证获取WFS图层URL功能
- **测试步骤**:
  1. 调用 `getWfsLayerUrl('cementPlants', { MAXFEATURES: 100 })`
- **预期结果**: 
  - 返回正确的WFS URL
  - URL参数正确

**测试用例 TC108: 获取图层信息**
- **测试目的**: 验证获取图层信息功能
- **测试步骤**:
  1. 调用 `getLayerInfo('cementPlants')`
- **预期结果**: 
  - 返回图层配置信息
  - 信息完整

**测试用例 TC109: 获取所有图层**
- **测试目的**: 验证获取所有图层功能
- **测试步骤**:
  1. 调用 `getAllLayers()`
- **预期结果**: 
  - 返回所有图层配置
  - 配置完整

**测试用例 TC110: 获取地图配置**
- **测试目的**: 验证获取地图配置功能
- **测试步骤**:
  1. 调用 `getMapConfig()`
- **预期结果**: 
  - 返回地图配置信息
  - 包含中心点、缩放级别等

**测试用例 TC111: 获取底图配置**
- **测试目的**: 验证获取底图配置功能
- **测试步骤**:
  1. 调用 `getBaseMaps()`
- **预期结果**: 
  - 返回底图配置信息
  - 包含OSM、卫星影像等

### 5. 管理员API测试用例

#### 5.1 用户管理测试用例

**测试用例 TC112: 分页查询用户**
- **测试目的**: 验证分页查询用户功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 调用 `pageUsers({ pageNum: 1, pageSize: 10 })`
- **预期结果**: 
  - 返回用户分页结果
  - 分页信息正确

**测试用例 TC113: 新增用户**
- **测试目的**: 验证新增用户功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 调用 `addUser({ username: 'newuser', password: '123456', email: 'new@example.com' })`
- **预期结果**: 
  - 返回添加成功信息
  - 用户创建成功

**测试用例 TC114: 更新用户**
- **测试目的**: 验证更新用户功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 调用 `updateUser({ id: 1, username: 'updateduser' })`
- **预期结果**: 
  - 返回更新成功信息
  - 用户信息更新

**测试用例 TC115: 删除用户**
- **测试目的**: 验证删除用户功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 调用 `deleteUser(1)`
- **预期结果**: 
  - 返回删除成功信息
  - 用户删除成功

**测试用例 TC116: 获取用户配额**
- **测试目的**: 验证获取用户配额功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 调用 `getQuota(1)`
- **预期结果**: 
  - 返回用户配额信息
  - 配额信息完整

**测试用例 TC117: 设置用户配额**
- **测试目的**: 验证设置用户配额功能
- **前置条件**: 用户已登录且为管理员
- **测试步骤**:
  1. 调用 `setQuota(1, 100, 24)`
- **预期结果**: 
  - 返回设置成功信息
  - 配额更新成功

### 6. 污染物管理API测试用例

#### 6.1 污染物管理测试用例

**测试用例 TC118: 分页查询污染物**
- **测试目的**: 验证分页查询污染物功能
- **测试步骤**:
  1. 调用 `pagePollution({ pageNum: 1, pageSize: 10 })`
- **预期结果**: 
  - 返回污染物分页结果
  - 分页信息正确

**测试用例 TC119: 根据ID获取污染物**
- **测试目的**: 验证根据ID获取污染物功能
- **测试步骤**:
  1. 调用 `getById(1)`
- **预期结果**: 
  - 返回指定污染物信息
  - 数据完整

#### 6.2 下载功能测试用例

**测试用例 TC120: 下载污染物数据**
- **测试目的**: 验证下载污染物数据功能
- **测试步骤**:
  1. 调用 `download([1, 2, 3])`
- **预期结果**: 
  - 返回文件Blob
  - 文件内容正确

**测试用例 TC121: 下载配额不足**
- **测试目的**: 验证下载配额不足时的处理
- **前置条件**: 用户下载配额不足
- **测试步骤**:
  1. 调用 `download([1, 2, 3])`
- **预期结果**: 
  - 抛出错误: "每日下载额度不足"

**测试用例 TC122: 提交异步下载任务**
- **测试目的**: 验证提交异步下载任务功能
- **测试步骤**:
  1. 调用 `enqueue([1, 2, 3])`
- **预期结果**: 
  - 返回任务ID
  - 任务提交成功

**测试用例 TC123: 获取异步任务状态**
- **测试目的**: 验证获取异步任务状态功能
- **测试步骤**:
  1. 调用 `taskStatus('task-id')`
- **预期结果**: 
  - 返回任务状态信息
  - 状态信息完整

**测试用例 TC124: 获取异步任务结果**
- **测试目的**: 验证获取异步任务结果功能
- **测试步骤**:
  1. 调用 `taskResult('task-id')`
- **预期结果**: 
  - 返回结果文件Blob
  - 文件内容正确

---

## 五、测试执行策略

### 1. 测试环境准备

#### 1.1 环境要求
- **开发环境**: Spring Boot 3 + Vue 3
- **测试数据库**: PostgreSQL测试数据库
- **测试工具**: Postman、Jest、Playwright
- **测试数据**: 预置测试数据

#### 1.2 测试数据准备
```sql
-- 用户测试数据
INSERT INTO user (username, password, email, role_code) VALUES 
('admin', 'e10adc3949ba59abbe56e057f20f883e', 'admin@example.com', 0),
('testuser', 'e10adc3949ba59abbe56e057f20f883e', 'test@example.com', 1);

-- 水泥厂测试数据
INSERT INTO cement_plants (plant_name, longitude, latitude, province, city, status) VALUES 
('测试水泥厂1', 114.3, 30.6, '湖北省', '武汉市', 'active'),
('测试水泥厂2', 114.4, 30.7, '湖北省', '武汉市', 'inactive');

-- 识别记录测试数据
INSERT INTO cement_plant_identifications (plant_id, longitude, latitude, ndvi_index, data_source) VALUES 
(1, 114.3, 30.6, 0.5, 'GF-2'),
(1, 114.3, 30.6, 0.6, 'Landsat-8');
```

### 2. 测试执行顺序

#### 2.1 后端API测试顺序
1. **用户管理模块** (TC001-TC018)
2. **水泥厂管理模块** (TC019-TC032)
3. **数据查询模块** (TC033-TC044)
4. **数据上传模块** (TC045-TC049)
5. **数据下载模块** (TC050-TC059)
6. **地理数据管理模块** (TC060-TC066)
7. **文件管理模块** (TC067-TC072)

#### 2.2 前端API测试顺序
1. **用户管理API** (TC073-TC077)
2. **水泥厂管理API** (TC078-TC093)
3. **TIF文件管理API** (TC094-TC105)
4. **GeoServer API** (TC106-TC111)
5. **管理员API** (TC112-TC117)
6. **污染物管理API** (TC118-TC124)

### 3. 测试自动化

#### 3.1 后端API自动化测试
```javascript
// 使用Jest进行API测试
describe('用户管理API', () => {
  test('用户注册', async () => {
    const response = await request(app)
      .post('/user/register')
      .send({
        username: 'testuser',
        password: '123456',
        email: 'test@example.com'
      });
    
    expect(response.status).toBe(200);
    expect(response.body.code).toBe(200);
  });
});
```

#### 3.2 前端API自动化测试
```javascript
// 使用Jest进行前端API测试
describe('用户管理API', () => {
  test('用户登录', async () => {
    const result = await login('testuser', '123456');
    expect(result.data.token).toBeDefined();
    expect(result.data.username).toBe('testuser');
  });
});
```

#### 3.3 E2E测试
```javascript
// 使用Playwright进行E2E测试
test('用户登录流程', async ({ page }) => {
  await page.goto('/login');
  await page.fill('[data-testid="username"]', 'testuser');
  await page.fill('[data-testid="password"]', '123456');
  await page.click('[data-testid="login-button"]');
  
  await expect(page).toHaveURL('/dashboard');
  await expect(page.locator('[data-testid="user-info"]')).toContainText('testuser');
});
```

### 4. 测试报告

#### 4.1 测试结果统计
- **总测试用例数**: 124个
- **后端API测试用例**: 72个
- **前端API测试用例**: 52个
- **预期通过率**: 95%以上

#### 4.2 测试报告模板
```markdown
# 测试报告

## 测试概况
- 测试时间: 2024-01-01
- 测试环境: 测试环境
- 测试人员: 测试团队

## 测试结果
- 总用例数: 124
- 通过用例数: 118
- 失败用例数: 6
- 通过率: 95.2%

## 问题汇总
1. TC045: 数据上传权限验证失败
2. TC067: 文件列表查询超时
3. ...

## 建议
1. 优化权限验证逻辑
2. 增加文件查询缓存
3. ...
```

---

## 六、总结

本文档详细罗列了水泥厂管理系统的所有功能接口，并设计了124个测试用例，覆盖了：

### 接口覆盖情况
1. **后端API接口**: 72个测试用例
   - 用户管理模块: 18个测试用例
   - 水泥厂管理模块: 14个测试用例
   - 数据查询模块: 12个测试用例
   - 数据上传模块: 5个测试用例
   - 数据下载模块: 10个测试用例
   - 地理数据管理模块: 7个测试用例
   - 文件管理模块: 6个测试用例

2. **前端API接口**: 52个测试用例
   - 用户管理API: 5个测试用例
   - 水泥厂管理API: 16个测试用例
   - TIF文件管理API: 12个测试用例
   - GeoServer API: 6个测试用例
   - 管理员API: 6个测试用例
   - 污染物管理API: 7个测试用例

### 测试覆盖范围
- **功能测试**: 覆盖所有业务功能
- **权限测试**: 验证用户权限控制
- **数据验证**: 验证数据格式和业务规则
- **异常处理**: 验证错误处理机制
- **性能测试**: 验证接口响应时间
- **安全测试**: 验证安全防护措施

### 测试质量保证
- **测试用例设计**: 基于等价类划分和边界值分析
- **测试数据准备**: 预置完整的测试数据
- **测试自动化**: 支持自动化测试执行
- **测试报告**: 提供详细的测试结果分析

这套测试用例设计为水泥厂管理系统提供了全面的质量保证，确保系统的稳定性和可靠性。
